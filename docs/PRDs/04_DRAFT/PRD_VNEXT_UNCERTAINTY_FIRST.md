# UDO Development Platform - PRD vNext (Uncertainty-First & Second Brain)

## 1. 목적 / 비전
- **목표**: 예측 → 완화 → 적응 중심의 개발 오케스트레이션을 제공하고, 세컨 브레인(Obsidian)과 대시보드를 통해 컨텍스트 유실 없이 팀이 스스로 학습·개선하도록 돕는다.
- **핵심 가치**
  - 사전 리스크 감지/예측(불확실성 맵 v3)
  - 즉시 실행 가능한 완화 전략(미티게이션 루프)
  - 실행 결과 기반 적응(Bayesian 학습, 타임트래킹 연동)
  - 지식 축적/재사용(Obsidian 세컨 브레인)

## 2. 사용자 시나리오 (초보/숙련 개발자 공통)
- **아이데이션**: 초기 컨텍스트 입력 → 불확실성 상태·신뢰도·예측 확인 → 위험 축별 가이드 확인
- **설계**: 설계 대안 검토 중 미티게이션/가이드 적용 → 결정·근거 로그 자동 기록
- **MVP/구현**: 실행 기록 ↔ 리스크 변화 타임라인 관찰 → 필요 시 미티게이션 적용 → 회로차단/캐시로 안정성 유지
- **테스트/검증**: 실패한 테스트가 품질 축 리스크에 반영, 통과 시 하향 조정 → Bayesian 임계치 업데이트
- **운영**: 리스크 급등/회로차단 열림 시 알림 → 토큰/비용/성공률 모니터링 → Obsidian으로 일지 자동 누적

## 3. 핵심 기능 / 요구사항
### 3.1 불확실성 엔진 & API
- 5차원 벡터(기술/시장/자원/일정/품질), Quantum State(Deterministic~Void), 24h 예측, 신뢰도/구간.
- **API**: `GET /api/uncertainty/status` (상태·신뢰도·예측·미티게이션), `GET /api/uncertainty/mitigations`, `POST /api/uncertainty/ack/{id}`.
- 회로차단/캐시: 불확실성 상태별 TTL, 실패율 임계 시 폴백/캐시 응답.

### 3.2 대시보드(Next.js)
- Uncertainty 패널: 상태 레전드(🟢🟡🟠🔴⚫), 신뢰도 게이지, 24h 예측, 미티게이션 카드(ROI/Impact/Success).
- 실행 히스토리 ↔ 리스크 변화 타임라인(“액션→리스크” 가시화).
- Guided Tips 패널: Phase/리스크별 행동 지침, 적용/무시 액션, 관련 문서/근거 링크.
- 상태 표시: 로딩/에러/폴백 명시, 반응형/접근성 준수.

### 3.3 Bayesian 통합 (UDO v2)
- `udo_bayesian_integration` 초기화, Phase별 적응형 임계치로 GO/NO_GO/Checkpoint 결정.
- 학습 루프: 실행/테스트 결과 피드백 → confidence 업데이트.

### 3.4 타임트래킹 연동
- 기준 대비 1.2x 초과 시 기술/일정 리스크 상승 이벤트 → 불확실성 재산정.
- ROI/병목 데이터를 대시보드와 공유.

### 3.5 미티게이션 루프
- 추천 전략 생성(ROI 내림차순), 적용/확정 시 리스크 하향 기록.
- 로그/결정 Obsidian 동기화.

### 3.6 AI 브리지 안정성
- 컨텍스트/리스크/Phase 주입, 캐시/회로차단/폴백(단일 AI/룰 기반).
- 호출 실패율/비용 지표 대시보드 표출.

### 3.7 Obsidian 세컨 브레인
- 실행/결정/미티게이션/팁 로그를 태그와 함께 자동 append.
- PRD/문서 버전 태깅, 컨텍스트 복구용 링크 제공.

### 3.8 PRD 업로드/멀티모달(옵션)
- 드래그앤드롭/파일 업로드(MD/PDF/텍스트/이미지) → 파싱/요약/임베딩 → 리스크 재산정.
- 업로드 처리 상태(큐/파싱/요약)를 UI에 표시.

### 3.9 보안/모니터링
- JWT/CORS/입력 검증, 민감정보 .env 분리.
- 라우터/AI 호출 계측, SLA 알림(리스크 급등/회로차단 열림/비용 상승).

## 4. 성공 지표
- 리스크 감축률(미티게이션 적용 후 상태 개선 비율)
- 의사결정 정확도 상승(Bayesian 통합 전후 GO/NO_GO 오판 감소)
- 토큰/비용 절감(캐시/회로차단으로 불필요 호출 감소율)
- 리드타임/MTTR 개선(타임트래킹·불확실성 이벤트 후 변화)
- 세컨 브레인 활용률(Obsidian 자동 로그/검색 활용도)

## 5. 기술 계약 (요약)
- API: `/api/uncertainty/status`, `/mitigations`, `/ack/{id}`, `/metrics`, `/execute`, `/time-tracking/*`.
- WebSocket: 상태/Phase/실행 이벤트 브로드캐스트.
- 캐시/회로차단: 불확실성 상태별 TTL, AI 호출 실패율 임계 설정.
- 데이터 모델: UncertaintyState/Vector/Prediction/Mitigation, Task/Phase/ROI.

## 6. UX 요구
- 명확한 상태(로딩/에러/폴백)와 레전드 일관성.
- 타임라인/차트로 “행동→리스크 변화”를 시각화.
- Tips/미티게이션에 근거/링크/효과(ROI/Success) 제공.
- 반응형/접근성(키보드, 명도 대비) 준수.

## 7. 우선순위 로드맵
1) 불확실성 브리지 완성(API↔대시보드, 미티게이션 표시)
2) 미티게이션 액션/타임트래킹 연동 → 리스크 재산정
3) Bayesian 통합(적응형 임계치, 학습 루프)
4) PRD 업로드/멀티모달 파이프라인 + 세컨 브레인 로그 강화
5) 모니터링/알림/비용 지표 정식 반영

## 8. 테스트/운영
- 백엔드: pytest + 시나리오(`tests/run_udo_phase1.py`), 회귀 커버리지 확대.
- 프론트: `npm run lint && npm run build`, API 계약 모킹 테스트.
- 알림: 리스크 급등/회로차단/비용 상승 시 Slack/웹훅 옵션.
